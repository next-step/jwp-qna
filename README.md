# JPA HandsOn

## ğŸš€ 1ë‹¨ê³„ - ì—”í‹°í‹° ë§¤í•‘

### Goal

QnA ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ê°€ë©´ì„œ JPAë¡œ ì‹¤ì œ ë„ë©”ì¸ ëª¨ë¸ì„ ì–´ë–»ê²Œ êµ¬ì„±í•˜ê³  ê°ì²´ì™€ í…Œì´ë¸”ì„ ì–´ë–»ê²Œ ë§¤í•‘í•´ì•¼ í•˜ëŠ”ì§€ ì•Œì•„ë³¸ë‹¤.

### Requirements

* ì•„ë˜ì˜ DDL(Data Definition Language)ì„ ë³´ê³  ìœ ì¶”í•˜ì—¬ ì—”í‹°í‹° í´ë˜ìŠ¤ì™€ ë¦¬í¬ì§€í† ë¦¬ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•´ ë³¸ë‹¤.
* @DataJpaTestë¥¼ ì‚¬ìš©í•˜ì—¬ í•™ìŠµ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³¸ë‹¤.

```sql
create table answer
(
    id          bigint generated by default as identity,
    contents    clob,
    created_at  timestamp not null,
    deleted     boolean   not null,
    question_id bigint,
    updated_at  timestamp,
    writer_id   bigint,
    primary key (id)
)

create table delete_history
(
    id            bigint generated by default as identity,
    content_id    bigint,
    content_type  varchar(255),
    create_date   timestamp,
    deleted_by_id bigint,
    primary key (id)
)

create table question
(
    id         bigint generated by default as identity,
    contents   clob,
    created_at timestamp    not null,
    deleted    boolean      not null,
    title      varchar(100) not null,
    updated_at timestamp,
    writer_id  bigint,
    primary key (id)
)

create table user
(
    id         bigint generated by default as identity,
    created_at timestamp   not null,
    email      varchar(50),
    name       varchar(20) not null,
    password   varchar(20) not null,
    updated_at timestamp,
    user_id    varchar(20) not null,
    primary key (id)
)

alter table user
    add constraint UK_a3imlf41l37utmxiquukk8ajc unique (user_id)


```

### TODO
- [x] JPA Auditing Entity
- [x] Enable JPA Audit in Application 
- [ ] Answer Entity
- [ ] Answer Test (CRUD)
- [ ] DeleteHistory Entity
- [ ] DeleteHistory Test(CRUD)
- [ ] Question Entity
- [ ] Question Test(CRUD)
- [x] User Entity
	- [x] ìŠ¤í‚¤ë§ˆì— ë§ê²Œ ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
	- [x] ë¶ˆí•„ìš”í•œ setter ì‚­ì œ
	- [x] equals / hashCode ì¶”ê°€
		- [x] core fields = id, userId
- [x] User Entity Test (CRUD)

### Hints

Spring Data JPA ì‚¬ìš© ì‹œ ì•„ë˜ ì˜µì…˜ì€ ë™ì‘ ì¿¼ë¦¬ë¥¼ ë¡œê·¸ë¡œ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

```
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.show-sql=true
```


### Note

* JPAëŠ”, IDê¸°ë°˜.
* JPAëŠ”, Dynamic Proxyê¸°ë°˜?ìœ¼ë¡œ ìƒì„±í•˜ê¸°ì—, default constructorí•„ìš”.
* CLOB = Character Large OBject
* @DataJpaTest
	* For DB layer slicing test
	* JPAì™€ ê´€ë ¨ëœ ë¹ˆë“¤ë§Œ ì´ˆê¸°í™” í•´ì¤€ë‹¤
	* @Txê°€ ê±¸ë ¤ìˆì–´, í…ŒìŠ¤íŠ¸ ëë‚  ë•Œë§ˆë‹¤ ë¡¤ë°± ì§€ì›
* JPA repo save()í•œ ê°’ì„ ì¨ë¼.
	* Use the returned instance for further operations as the save operation might have changed the entity instance completely.
* @CreatedDate, You dont have to set value manually .

### QnA

##### Q: JPAê°€ ì‚¬ìš©í•˜ëŠ” Proxyê¸°ìˆ ì€? GCLIB? Dynamic Proxy?

##### Q: Generation Type attributes?

##### Q: ë¬´ì¡°ê±´ ë‹¤ @Columnì†ì„± ì§€ì •í•´ì•¼ í•˜ë‚˜?
->  NO
```java
/**
 * Specifies the mapped column for a persistent property or field.
 * If no <code>Column</code> annotation is specified, the default values apply.
 *
 * <blockquote><pre>
 *    Example 1:
 *
 *    &#064;Column(name="DESC", nullable=false, length=512)
 *    public String getDescription() { return description; }
 *
 *    Example 2:
 *
 *    &#064;Column(name="DESC",
 *            columnDefinition="CLOB NOT NULL",
 *            table="EMP_DETAIL")
 *    &#064;Lob
 *    public String getDescription() { return description; }
 *
 *    Example 3:
 *
 *    &#064;Column(name="ORDER_COST", updatable=false, precision=12, scale=2)
 *    public BigDecimal getCost() { return cost; }
 *
 * </pre></blockquote>
 *
 *
 * @since 1.0
 */ 
```

##### Q : sql.TimeStamp vs Date vs LocalDateTime?
- Data : ëª¨í˜¸í•œ ì„¤ê³„ ì™€ ê°€ë³€ì„±/ ì‹œê°„ì„ MSì´ˆë¡œ í‘œí˜„ /1900ë…„ ì‹œì‘ Offset / 0ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë‹¬ ì¸ë±ìŠ¤ / ì¤‘ì•™ìœ ëŸ½ì‹œê°„
- LocalDateTime (from Java8) : ë¶ˆë³€/ NSê¹Œì§€ í‘œí˜„ê°€ëŠ¥ /. No Offset / 1ë¡œ ì‹œì‘í•˜ëŠ” ë‹¬ ì¸ë±ìŠ¤
- TimeStamp : NSê¹Œì§€ í‘œí˜„ ê°€ëŠ¥


##### Q: How to set Unique Constraints in JPA?
- Unique key is a set of single or multiple columns of a table that uniquely identify a record in a database table
- JPA allows us to define unique constraints in our code using 
- Column Constraints -> @Column(unique=true) 
- Table Constraints -> @UniqueConstraint. 
- Refer : https://www.baeldung.com/jpa-unique-constraints

##### Q : JPA Buddy plug inìœ¼ë¡œ ë¬´ì—‡ì´ ê°€ëŠ¥í•œì§€?
- Refer : https://www.jpa-buddy.com/?utm_source=baeldung&utm_medium=display&utm_campaign=npi

##### Q : 	BaseTimeEntityë¥¼ ìƒì†í•œ ì—”í‹°í‹°í´ë˜ìŠ¤ì—ì„œ, Super ìƒì„±ìë¥¼ ë¶€ë¥´ì§€ ì•ŠëŠ”ë°,  ì–´ë–»ê²Œ ì»´íŒŒì¼ì´ ë˜ëŠ”ê±´ì§€? @MappedSuperclass ë™ì‘ í™•ì¸

##### Q : Entityì˜ ID í•„ë“œë¥¼ ë…¼ë¦¬ ë™ì¹˜ì„±(ë™ë“±ì„±) ê³„ì‚°ì‹œ í¬í•¨í•´ì•¼ í•˜ë‚˜?
- ë§Œì•½ í¬í•¨í•œë‹¤ë©´, DBë³´ì¡´ ì „í›„ë¡œ, equals()ë¥¼ í†µí•œ ë™ë“±ì„± ê³„ì‚°ì— ì‹¤íŒ¨í•˜ê²Œ ëœë‹¤.
	- ê°œì²´ ìƒì„±ì‹œ IDê°€ ì¡´ì¬ í•˜ì§€ ì•ŠëŠ” ê°œì²´ëŠ” , JPAí†µí•´ saveí›„ì—ëŠ” IDê°€ ì¡´ì¬í•˜ê²Œ ë˜ë¯€ë¡œ.
	- ì´ê²Œ ë§ë‚˜?
	- êµ³ì´ ì§€ê¸ˆ ìš”êµ¬ì‚¬í•­ì„ ëª¨ë¥´ëŠ”ë°, ì„£ë¶€ë¥´ê²Œ ë™ë“±ì„± íŒë‹¨ì„ í•˜ë ¤ê³  í•˜ëŠ”ê²Œ ì•„ë‹Œê°€?
	- Step1ì—ì„œëŠ” ë™ë“±ì„± ê³„ì‚° ë³´ë¥˜.

Q : saveì „í›„ë¡œ ì°¸ì¡° ìš”ì†Œê°€ ë‹¬ë¼ì§€ëŠ”ê±´, IDì†ì„±ì´ NULLì¼ë•Œë§Œ ì•„ë‹ˆì—ˆë‚˜? 
