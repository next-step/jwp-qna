## step3 요구사항

1. 질문 삭제하기를 리팩토링 한다
2. service layer 의 로직을 domain 으로 이관해야 한다
3. 현재 존재하는 test는 통과해야 한다.
4. 사상 불일치를 해소하는 경험을 하자(객체지향적인 코드)
5. 단위 테스트하기 어려운 코드와 단위 테스트 가능한 코드를 분리해 단위 테스트 가능한 코드에 대해 단위 테스트를 구현한다.

## 요구 사항

- 다음의 DDL을 entity 와 매핑한다
- `@DataJpaTest` 를 사용하여 학습 테스트를 작성한다

## DDL

```sql
create table answer
(
    id          bigint generated by default as identity,
    contents    clob,
    created_at  timestamp not null,
    deleted     boolean   not null,
    question_id bigint,
    updated_at  timestamp,
    writer_id   bigint,
    primary key (id)
)
```

```sql
create table delete_history
(
    id            bigint generated by default as identity,
    content_id    bigint,
    content_type  varchar(255),
    create_date   timestamp,
    deleted_by_id bigint,
    primary key (id)
)
```

```sql
create table question
(
    id         bigint generated by default as identity,
    contents   clob,
    created_at timestamp    not null,
    deleted    boolean      not null,
    title      varchar(100) not null,
    updated_at timestamp,
    writer_id  bigint,
    primary key (id)
)
```

```sql
create table user
(
    id         bigint generated by default as identity,
    created_at timestamp   not null,
    email      varchar(50),
    name       varchar(20) not null,
    password   varchar(20) not null,
    updated_at timestamp,
    user_id    varchar(20) not null,
    primary key (id)
)

alter table user
    add constraint UK_a3imlf41l37utmxiquukk8ajc unique (user_id)
```

## 연관관계

다음의 fk 를 적용한다

```sql
alter table answer
    add constraint fk_answer_to_question
        foreign key (question_id)
            references question
```

```sql
alter table answer
    add constraint fk_answer_writer
        foreign key (writer_id)
            references user
```

```sql
alter table delete_history
    add constraint fk_delete_history_to_user
        foreign key (deleted_by_id)
            references user
```

```sql
alter table question
    add constraint fk_question_writer
        foreign key (writer_id)
            references user
```

## 객체 

1. `Question`
    - `User`, `List<Answer>` 를 갖고 있다
2. `Answer`
    - `Question`, `User` 를 갖고 있다
3. `DeleteHistory`
    - `User` 만 가지고 있으며, `Question`, `Answer` 는 id 만 갖는다
4. `User`
    - 참조 형태로 다른곳에서 참조 된다